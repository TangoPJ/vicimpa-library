# @vicimpa/week-store

Библиотека `@vicimpa/week-store` предоставляет утилиты для создания и управления
слабо ссылаемыми хранилищами в JavaScript. Это может быть особенно полезно для
управления метаданными или вспомогательными данными, связанными с объектами, без
предотвращения их сборки мусора.

## Документация по API

### `makeWeekStore`

Создает слабое хранилище для управления данными, связанными с объектами.

#### Синтаксис

```ts
makeWeekStore<T>(init: () => T) => T
```

#### Параметры

- `init`: Функция, которая возвращает начальное значение для хранилища.
- `name` (необязательно): Строка для именования символа, используемого внутри.
  По умолчанию `'store'`.

#### Возвращает

Функцию, которая принимает объект и возвращает связанное с ним значение из
хранилища. Если у объекта нет связанного значения, оно инициализируется с
помощью функции `init`.

#### Пример

```ts
import { makeWeekStore } from "@vicimpa/week-store";

const init = () => ({ count: 0 });
const store = makeWeekStore(init);

const obj = {};
const data = store(obj);
data.count += 1;

console.log(store(obj).count); // 1
```

### `makeWeekProtoStore`

Создает слабое хранилище, которое поддерживает обход цепочки прототипов для
сбора значений.

#### Синтаксис

```ts
makeWeekProtoStore<T>(): {
  store(obj: object, value: T): void;
  collect(obj: object | null): T[];
}
```

#### Возвращает

Объект с двумя методами:

- `store(obj: object, value: T)`: Сохраняет значение, связанное с объектом.
- `collect(obj: object | null)`: Собирает значения из объекта и его цепочки
  прототипов.

#### Пример

```ts
import { makeWeekProtoStore } from "@vicimpa/week-store";

const storeKeys = makeWeekProtoStore<string | symbol>();

class Test1 {
  @storeKeys.store
  test1 = "1";
}

class Test2 extends Test1 {
  @storeKeys.store
  test2 = "2";
}

const obj1 = new Test1();
const obj2 = new Test2();

console.log(storeKeys.collect(obj1)); // ["test1"]
console.log(storeKeys.collect(obj2)); // ["test2", "test1"]
```

## Подробное описание

### `makeWeekStore`

Функция `makeWeekStore` создает слабое хранилище с использованием `WeakMap`. Это
позволяет ассоциировать данные с объектами без предотвращения их сборки мусора.
Функция `init` используется для инициализации значения, если у объекта еще нет
связанного значения.

### `makeWeekProtoStore`

Функция `makeWeekProtoStore` строится на основе `makeWeekStore` и предоставляет
хранилище, которое может обходить цепочку прототипов объекта. Это полезно в
сценариях, когда нужно собирать значения не только из самого объекта, но и из
его прототипов.

Метод `store` позволяет ассоциировать значение с объектом, а метод `collect`
обходит цепочку прототипов объекта и собирает все связанные значения.

## Примеры использования

- **Управление метаданными**: Хранение и управление метаданными, связанными с
  объектами, без влияния на их сборку мусора.
- **Сбор данных из цепочки прототипов**: Сбор данных из объекта и его
  прототипов, полезно для дизайнов, основанных на наследовании.
- **Хранение вспомогательных данных**: Хранение вспомогательных данных,
  связанных с объектами, таким образом, чтобы это не влияло на жизненный цикл
  объектов.

## Заключение

Библиотека `@vicimpa/week-store` предоставляет простой, но мощный способ
управления слабо ссылаемыми хранилищами в JavaScript. Используя `WeakMap` и
обход цепочки прототипов, она предлагает гибкие решения для различных сценариев
управления данными.
